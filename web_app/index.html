<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol DT - Los Palometas</title>
    <!-- Cropper.js for player photos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dark-theme">

    <!-- Login Screen Overlay -->
    <div id="login-overlay" class="login-overlay active">
        <div class="login-card">
            <img src="images/logo.png" alt="Logo" class="login-logo">
            <h1>FUTBOL<span>DT</span></h1>
            <p>Inicia sesi√≥n para acceder al panel t√©cnico</p>

            <form id="login-form">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="login-email" placeholder="Correo electr√≥nico" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="login-password" placeholder="Contrase√±a" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> INGRESAR
                </button>
            </form>
            <p class="login-footer">Los Palometas FC - Gesti√≥n de Plantilla</p>
        </div>
    </div>

    <!-- Mobile Toggle Button -->
    <button id="mobile-toggle" class="mobile-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Navigation (Desktop/Tablet) -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="images/logo.png" alt="Logo" class="main-logo">
            <h2>PALOMETAS<span>FC</span></h2>
        </div>
        <ul class="nav-links">
            <li class="active" data-screen="home"><i class="fas fa-home"></i> <span>Inicio</span></li>
            <li data-screen="players"><i class="fas fa-users"></i> <span>Jugadoras</span></li>
            <li data-screen="tactic"><i class="fas fa-chalkboard-user"></i> <span>Pizarra T√°ctica</span></li>
            <li data-screen="attendance"><i class="fas fa-clipboard-check"></i> <span>Asistencia</span></li>
            <li data-screen="planning"><i class="fas fa-calendar-alt"></i> <span>Planificaci√≥n</span></li>
            <li data-screen="library"><i class="fas fa-dumbbell"></i> <span>Biblioteca</span></li>
            <li data-screen="gif-maker"><i class="fas fa-video"></i> <span>Creador GIFs</span></li>
            <li data-screen="matches"><i class="fas fa-trophy"></i> <span>Partidos</span></li>
            <li data-screen="stats"><i class="fas fa-chart-line"></i> <span>Estad√≠sticas</span></li>
            <li data-screen="config" id="nav-config" style="display: none;"><i class="fas fa-cog"></i>
                <span>Configuraci√≥n</span>
            </li>
        </ul>
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="auth.logout()">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
            </button>
            <p>v1.0 Online</p>
        </div>
    </nav>

    <!-- Mobile Overlay Backdrop -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Main Content -->
    <main class="content-area">
        <!-- Screen: Home -->
        <section id="screen-home" class="screen active">
            <header>
                <h1>Panel de Control</h1>
                <p>Bienvenido, Director T√©cnico</p>
            </header>

            <div class="quick-stats">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-info">
                        <h3 id="stat-total-players">0</h3>
                        <p>Jugadoras</p>
                    </div>
                </div>
                <div class="stat-card" style="border-bottom: 4px solid var(--accent-color);">
                    <i class="fas fa-birthday-cake" style="color: var(--accent-color);"></i>
                    <div class="stat-info">
                        <h3 id="stat-bday-month">0</h3>
                        <p>Cumples del Mes</p>
                    </div>
                </div>
                <div class="stat-card" style="border-bottom: 4px solid #e74c3c;">
                    <i class="fas fa-user-injured" style="color: #e74c3c;"></i>
                    <div class="stat-info">
                        <h3 id="stat-injured-count">0</h3>
                        <p>Lesionadas</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Category Summary -->
                <div class="config-card">
                    <h3>üìä Resumen por Categor√≠a</h3>
                    <div id="category-stats-list" style="margin-top: 15px;">
                        <!-- JS populated -->
                    </div>
                </div>

                <!-- Next Matches -->
                <div class="config-card">
                    <h3>‚öΩ Pr√≥ximos Partidos</h3>
                    <div id="home-next-matches" style="margin-top: 15px;">
                        <p class="text-muted">No hay partidos programados</p>
                    </div>
                </div>
            </div>

            <div id="monthly-birthdays" class="config-card" style="margin-top: 20px; display: none;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>üéÇ Cumplea√±os de Enero</h3>
                    <button class="btn btn-secondary btn-sm" onclick="app.syncAllBirthdays()">
                        <i class="fas fa-calendar-plus"></i> Sincronizar Agenda
                    </button>
                </div>
                <div id="birthday-list"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; margin-top: 15px;">
                    <!-- Se llena con JS -->
                </div>
            </div>

            <div id="monthly-birthdays" class="config-card" style="margin-bottom: 30px; display: none;">
                <h3>üéÇ Cumplea√±os del Mes</h3>
                <div id="birthday-list" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    <!-- Se llena con JS -->
                </div>
            </div>

            <div class="recent-actions">
                <h2>Acceso R√°pido</h2>
                <div class="action-grid">
                    <button class="action-btn" onclick="app.showScreen('tactic')">
                        <i class="fas fa-chalkboard"></i>
                        Abrir Pizarra
                    </button>
                    <button class="action-btn" onclick="app.showScreen('attendance')">
                        <i class="fas fa-user-plus"></i>
                        Tomar Asistencia
                    </button>
                    <button class="action-btn" onclick="app.showScreen('players')">
                        <i class="fas fa-user-edit"></i>
                        Ver Plantilla
                    </button>
                </div>
            </div>
        </section>

        <!-- Screen: Tactic Board (The most complex one) -->
        <section id="screen-tactic" class="screen">
            <header class="tactic-header">
                <div class="title-group">
                    <h1>Pizarra T√°ctica</h1>
                    <div class="tactic-inputs">
                        <input type="text" id="rival-name" placeholder="Rival / Evento">
                        <input type="date" id="match-date">
                    </div>
                </div>
                <div class="tactic-controls">
                    <button class="btn btn-secondary" onclick="tacticBoard.deleteSelection()"><i
                            class="fas fa-trash-alt"></i>
                        Borrar</button>
                    <button class="btn btn-secondary" onclick="tacticBoard.clear()"><i class="fas fa-eraser"></i>
                        Limpiar</button>
                    <button class="btn btn-primary" onclick="tacticBoard.save()"><i class="fas fa-save"></i>
                        Guardar</button>
                    <button class="btn btn-accent" onclick="tacticBoard.exportImage()"><i class="fas fa-download"></i>
                        WhatsApp</button>
                </div>
            </header>

            <div class="tactic-layout">
                <!-- Left Panel: Players -->
                <aside class="players-panel">
                    <div class="players-filters" style="margin-bottom: 10px;">
                        <button class="filter-chip active" onclick="tacticBoard.setFilter('1ra', this)">1ra</button>
                        <button class="filter-chip" onclick="tacticBoard.setFilter('Res', this)">Res</button>
                        <button class="filter-chip" onclick="tacticBoard.setFilter('Sub17', this)">Sub17</button>
                    </div>
                    <div id="player-pool" class="player-pool">
                        <!-- Players will be added here -->
                    </div>

                    <div class="drawing-tools">
                        <h3>Herramientas</h3>
                        <div class="tool-grid">
                            <button class="tool-btn active" data-tool="move" title="Mover"><i
                                    class="fas fa-mouse-pointer"></i></button>
                            <button class="tool-btn" data-tool="line" title="L√≠nea"><i
                                    class="fas fa-minus"></i></button>
                            <button class="tool-btn" data-tool="arrow" title="Flecha"><i
                                    class="fas fa-long-arrow-alt-right"></i></button>
                            <button class="tool-btn" data-tool="opponent" title="Contrincante"><i class="fas fa-circle"
                                    style="color: blue;"></i></button>
                        </div>
                    </div>
                </aside>

                <!-- Center: Field -->
                <div class="field-container">
                    <canvas id="tactic-canvas"></canvas>
                </div>

                <!-- Right Panel: Substitutes -->
                <aside class="options-panel">
                    <div id="substitutes-list-auto" class="config-card"
                        style="background: rgba(0,0,0,0.2); min-height: 100px; padding: 10px;">
                        <!-- Auto generated subs -->
                        <p class="text-muted" style="font-size: 0.8rem;">Coloca jugadoras en la cancha para ver
                            suplentes</p>
                    </div>
                    <textarea id="substitutes-text" style="display:none;"></textarea>

                    <div class="history-section">
                        <h3>Historial</h3>
                        <div id="formation-history" class="history-list">
                            <!-- Saved formations -->
                        </div>
                    </div>
                </aside>
            </div>
        </section>

        <!-- Screen: Gesti√≥n de Jugadoras -->
        <section id="screen-players" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Gesti√≥n de Jugadoras</h1>
                    <p>Administra la plantilla completa de Los Palometas</p>
                </div>
                <div class="header-actions" style="display:flex; gap:10px;">
                    <button class="btn btn-secondary" onclick="playersManager.exportPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                    <button class="btn btn-primary" onclick="playersManager.showAddModal(true)">
                        <i class="fas fa-plus"></i> Nueva Jugadora
                    </button>
                </div>
            </header>

            <div class="players-filters">
                <button class="filter-chip active" onclick="playersManager.setFilter('Todas', this)">Todas</button>
                <button class="filter-chip" onclick="playersManager.setFilter('1ra', this)">1ra</button>
                <button class="filter-chip" onclick="playersManager.setFilter('Res', this)">Reserva</button>
                <button class="filter-chip" onclick="playersManager.setFilter('Sub17', this)">Sub17</button>
            </div>

            <div id="players-grid" class="players-grid">
                <!-- Player cards dynamically loaded -->
            </div>

        </section>
        <section id="screen-attendance" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Control de Asistencia</h1>
                    <p>Marca las jugadoras que asistieron al entrenamiento del d√≠a</p>
                </div>
                <div class="attendance-controls" style="display: flex; gap: 10px; align-items: center;">
                    <div class="input-group" style="margin-bottom: 0;">
                        <input type="date" id="attendance-date" style="padding: 10px 15px;">
                    </div>
                    <button class="btn btn-secondary" onclick="attendanceManager.toggleAll(true)">
                        <i class="fas fa-check-double"></i> Todas Presentes
                    </button>
                    <button id="btn-delete-attendance" class="btn btn-secondary"
                        style="display: none; background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid rgba(231, 76, 60, 0.2);"
                        onclick="attendanceManager.deleteSession(attendanceManager.currentDate)">
                        <i class="fas fa-trash-alt"></i> Borrar Sesi√≥n
                    </button>
                    <button class="btn btn-primary" onclick="attendanceManager.saveAll()">
                        <i class="fas fa-save"></i> Guardar Todo
                    </button>
                </div>
            </header>

            <div class="attendance-layout"
                style="display: grid; grid-template-columns: 1fr 350px; gap: 25px; margin-top: 20px;">
                <div class="attendance-main">
                    <div id="attendance-status-banner" style="margin-bottom: 15px;"></div>
                    <div id="attendance-list" class="attendance-list">
                        <!-- Creado con JS -->
                    </div>
                </div>
                <div class="attendance-sidebar">
                    <div class="config-card">
                        <h3 style="margin-bottom: 15px;"><i class="fas fa-history"></i> Historial de Sesiones</h3>
                        <div id="attendance-history-list" style="max-height: 600px; overflow-y: auto;">
                            <p class="text-muted">Cargando historial...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="screen-planning" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Planificaci√≥n del Entrenamiento</h1>
                    <p>Organiza las sesiones y objetivos de la semana</p>
                </div>
            </header>

            <div class="planning-layout">
                <div class="planning-form config-card">
                    <h3>Nuevo Entrenamiento</h3>
                    <form id="add-plan-form" onsubmit="event.preventDefault(); planningManager.addPlan()">
                        <div class="input-group">
                            <label>T√≠tulo de la Sesi√≥n</label>
                            <input type="text" id="plan-title" placeholder="Ej: T√°ctico - Salida de fondo" required>
                        </div>
                        <div class="input-group">
                            <label>Fecha</label>
                            <input type="date" id="plan-date" required>
                        </div>
                        <div class="input-group">
                            <label>Objetivos / Notas</label>
                            <textarea id="plan-content" placeholder="Escribe los ejercicios o puntos clave..."
                                style="height: 100px;"></textarea>
                        </div>
                        <div class="exercise-selector">
                            <h4>Vincular Ejercicios de la Biblioteca</h4>
                            <div class="search-bar" style="margin-bottom: 15px; width: 100%;"
                                id="selector-search-container">
                                <i class="fas fa-search"></i>
                                <input type="text" id="selector-search" placeholder="Busca por Nombre, Tipo o Desc..."
                                    oninput="planningManager.handleSelectorSearch()">
                            </div>
                            <div id="mini-exercise-grid" class="exercises-mini-grid">
                                <!-- Se llena con JS -->
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" style="margin-top:20px;">Guardar
                            Sesi√≥n</button>
                    </form>
                </div>

                <div class="planning-history">
                    <h3>Sesiones Programadas</h3>
                    <div class="plans-header-actions">
                        <div class="search-bar" style="max-width: 100%; margin-bottom: 15px;">
                            <i class="fas fa-search"></i>
                            <input type="text" id="planning-search" placeholder="Buscar sesi√≥n por t√≠tulo..."
                                oninput="planningManager.handleSearch()">
                        </div>
                    </div>
                    <div id="planning-list" class="plans-grid">
                        <!-- Plans will load here -->
                    </div>
                </div>
            </div>
        </section>
        <section id="screen-library" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Biblioteca de Ejercicios</h1>
                    <p>Colecci√≥n de trabajos t√°cticos y f√≠sicos con GIFs</p>
                </div>
                <button class="btn btn-primary" onclick="libraryManager.showAddModal(true)">
                    <i class="fas fa-plus"></i> Nuevo Ejercicio
                </button>
            </header>

            <div class="library-header-actions">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="library-search" placeholder="Buscar ejercicio..."
                        oninput="libraryManager.handleSearch()">
                </div>
            </div>

            <div class="library-filters" id="library-filters">
                <button class="chip active" data-cat="all">Todos</button>
                <button class="chip" data-cat="T√°ctico">T√°ctico</button>
                <button class="chip" data-cat="T√©cnico">T√©cnico</button>
                <button class="chip" data-cat="F√≠sico">F√≠sico</button>
                <button class="chip" data-cat="Arqueras">Arqueras</button>
                <button class="chip" data-cat="ABP">Estrategia (ABP)</button>
                <button class="chip" data-cat="Calor">Entrada en Calor</button>
                <button class="chip" data-cat="Psicol√≥gico">Psicol√≥gico</button>
            </div>

            <div id="library-grid" class="library-grid">
                <!-- Exercises will load here -->
            </div>
        </section>

        <section id="screen-library" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Biblioteca de Ejercicios</h1>
                    <p>Colecci√≥n de trabajos t√°cticos y f√≠sicos con GIFs</p>
                </div>
                <button class="btn btn-primary" onclick="libraryManager.showAddModal(true)">
                    <i class="fas fa-plus"></i> Nuevo Ejercicio
                </button>
            </header>
            <div id="library-grid" class="library-grid">
                <!-- Exercises will load here -->
            </div>
        </section>

        <section id="screen-stats" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Estad√≠sticas de Rendimiento</h1>
                    <p>M√©tricas de asistencia y compromiso del equipo</p>
                </div>
            </header>

            <div id="stats-content" class="stats-container">
                <!-- Data will load here -->
            </div>
        </section>

        <!-- Screen: Configuration (Only for perrolocosanchez) -->
        <section id="screen-config" class="screen">
            <header>
                <h1>Configuraci√≥n de Acceso</h1>
                <p>Gestiona los correos autorizados para el cuerpo t√©cnico</p>
            </header>

            <div class="config-container">
                <div class="config-card">
                    <h3>Agregar Nuevo Acceso</h3>
                    <div class="config-input-row">
                        <div class="input-group">
                            <i class="fas fa-user-plus"></i>
                            <input type="email" id="new-user-email" placeholder="Email del compa√±ero">
                        </div>
                        <button class="btn btn-primary" onclick="auth.addUserAccess()">
                            <i class="fas fa-plus"></i> Habilitar
                        </button>
                    </div>
                </div>

                <div class="config-card">
                    <h3>Usuarios Habilitados</h3>
                    <div id="authorized-users-list" class="user-list">
                        <!-- Lista de emails autorizados -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Screen: Creador de GIFs -->
        <section id="screen-gif-maker" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Creador de GIFs T√°cticos</h1>
                    <p>Dise√±a tus propios ejercicios animados paso a paso</p>
                </div>
            </header>

            <div class="tactic-layout">
                <aside class="players-panel">
                    <h3>Elementos</h3>
                    <div class="tool-grid">
                        <button class="tool-btn active" data-tool="move" title="Mover"><i
                                class="fas fa-mouse-pointer"></i></button>
                        <button class="tool-btn" data-tool="player_y" title="Jugadora (Y)"><i class="fas fa-user"
                                style="color: #ffd700;"></i></button>
                        <button class="tool-btn" data-tool="player_m" title="Jugadora (M)"><i class="fas fa-user"
                                style="color: #800020;"></i></button>
                        <button class="tool-btn" data-tool="ball" title="Pelota"><i
                                class="fas fa-soccer-ball"></i></button>
                        <button class="tool-btn" data-tool="cone" title="Cono"><i class="fas fa-mountain"
                                style="color: orange;"></i></button>
                        <button class="tool-btn" data-tool="ring" title="Aro"><i class="far fa-circle"
                                style="color: #ff9800;"></i></button>
                        <button class="tool-btn" data-tool="stick" title="Valla/Palo"><i
                                class="fas fa-grip-lines-vertical" style="color: #ccc;"></i></button>
                        <button class="tool-btn" data-tool="ladder" title="Escalera"><i class="fas fa-th"
                                style="color: white;"></i></button>
                        <button class="tool-btn" data-tool="goal" title="Arco"><i class="fas fa-warehouse"
                                style="color: white;"></i></button>
                        <button class="tool-btn" data-tool="dummy" title="Maniqu√≠"><i class="fas fa-male"
                                style="color: #555;"></i></button>
                        <button class="tool-btn" data-tool="arrow" title="Flecha Movimiento"><i
                                class="fas fa-long-arrow-alt-right"></i></button>
                        <button class="tool-btn" data-tool="line" title="Trazo"><i
                                class="fas fa-pencil-alt"></i></button>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-secondary btn-block" onclick="gifMaker.undo()"><i
                                class="fas fa-undo"></i> Deshacer</button>
                        <button class="btn btn-secondary btn-block" onclick="gifMaker.clear()"><i
                                class="fas fa-trash"></i> Limpiar</button>
                    </div>
                </aside>

                <div class="field-container">
                    <canvas id="gif-canvas"></canvas>
                </div>

                <aside class="options-panel">
                    <h3>Secuencia del GIF</h3>
                    <div class="input-group">
                        <label>Nombre del Ejercicio</label>
                        <input type="text" id="gif-name" placeholder="Ej: Salida 4-3-3">
                    </div>
                    <div id="frame-counter"
                        style="text-align: center; font-size: 1.2rem; margin-bottom: 20px; color: var(--accent-color);">
                        Frames: 0</div>
                    <button class="btn btn-primary btn-block" onclick="gifMaker.captureFrame()">
                        <i class="fas fa-camera"></i> Capturar Frame
                    </button>
                    <button class="btn btn-secondary btn-block" style="margin-top: 10px;"
                        onclick="gifMaker.generateGif()">
                        <i class="fas fa-magic"></i> Generar Animaci√≥n
                    </button>
                    <button class="btn btn-secondary btn-block" style="margin-top: 10px;" onclick="gifMaker.resetGif()">
                        <i class="fas fa-redo"></i> Reiniciar Secuencia
                    </button>
                    <div id="gif-preview-container" style="margin-top: 20px; text-align: center;">
                        <!-- Preview will show here -->
                    </div>
                </aside>
            </div>
        </section>
        <section id="screen-matches" class="screen">
            <header class="screen-header">
                <div class="header-title">
                    <h1>Agenda de Partidos</h1>
                    <p>Programaci√≥n, resultados y tablas por categor√≠a</p>
                </div>
                <button class="btn btn-primary" onclick="matchesManager.showAddModal(true)">
                    <i class="fas fa-plus"></i> Nuevo Partido
                </button>
            </header>

            <div class="matches-layout" style="display: grid; grid-template-columns: 1fr 400px; gap: 20px;">
                <div class="matches-list-section">
                    <div class="players-filters">
                        <button class="filter-chip active"
                            onclick="matchesManager.setFilter('Todas', this)">Todas</button>
                        <button class="filter-chip" onclick="matchesManager.setFilter('1ra', this)">1ra</button>
                        <button class="filter-chip" onclick="matchesManager.setFilter('Res', this)">Reserva</button>
                        <button class="filter-chip" onclick="matchesManager.setFilter('Sub17', this)">Sub17</button>
                    </div>
                    <div id="matches-grid" class="matches-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px;">
                        <!-- Match cards -->
                    </div>
                </div>
                <div class="standings-section config-card">
                    <h3>üèÜ Historial y Resultados</h3>
                    <div id="standings-container" style="margin-top:20px;">
                        <p class="text-muted">Cargando resultados...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Firebase SDK (Compat Mode) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <!-- Modal: Agregar Jugadora (Global) -->
    <div id="modal-player" class="modal-overlay">
        <div class="modal-card">
            <h2 id="player-modal-title">Nueva Jugadora</h2>
            <form id="add-player-form" onsubmit="event.preventDefault(); playersManager.savePlayer()">
                <input type="hidden" id="p-edit-id">
                <div class="form-grid">
                    <div class="input-group" style="grid-column: 1/-1;">
                        <label>Foto de la Jugadora</label>
                        <div id="cropper-wrapper" style="display:none; margin-bottom: 20px;">
                            <div style="max-height: 400px; overflow: hidden;">
                                <img id="cropper-image" src="" style="max-width: 100%;">
                            </div>
                            <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
                                <button type="button" class="btn btn-primary"
                                    onclick="playersManager.applyCrop()">Recortar Cara</button>
                                <button type="button" class="btn btn-secondary"
                                    onclick="playersManager.cancelCrop()">Cancelar</button>
                            </div>
                        </div>
                        <div class="photo-preview-container" id="p-photo-container">
                            <img id="p-photo-preview" src="images/camiseta.png" alt="Preview">
                        </div>
                        <div class="input-group" style="margin-top: 10px;">
                            <label>URL o Ruta de Foto (GitHub)</label>
                            <input type="text" id="p-photo-url" placeholder="Ej: images/players/foto.png"
                                onchange="document.getElementById('p-photo-preview').src = this.value || 'images/camiseta.png'">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Alias (En camiseta)</label>
                        <input type="text" id="p-alias" placeholder="Ej: Ana P." required>
                    </div>
                    <div class="input-group">
                        <label>Nombre Completo</label>
                        <input type="text" id="p-name" placeholder="Nombre y Apellido">
                    </div>
                    <div class="input-group">
                        <label>DNI / Documento</label>
                        <input type="text" id="p-dni" placeholder="Sin puntos">
                    </div>
                    <div class="input-group">
                        <label>Fecha de Nacimiento</label>
                        <input type="date" id="p-birthdate">
                    </div>
                    <div class="input-group">
                        <label>Categor√≠a</label>
                        <select id="p-cat">
                            <option value="1ra">Primera Division</option>
                            <option value="Res">Reserva</option>
                            <option value="Sub17">Sub 17</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Posici√≥n Principal</label>
                        <select id="p-pos1">
                            <option value="Arquera">Arquera</option>
                            <option value="Defensora Central">Defensora Central</option>
                            <option value="Lateral">Lateral</option>
                            <option value="Mediocampista Central">Mediocampista Central</option>
                            <option value="Mediocampiva Ofensiva">Mediocampista Ofensiva</option>
                            <option value="Volante">Volante</option>
                            <option value="Delantera">Delantera</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Segunda Posici√≥n</label>
                        <select id="p-pos2">
                            <option value="-">-</option>
                            <option value="Arquera">Arquera</option>
                            <option value="Defensora Central">Defensora Central</option>
                            <option value="Lateral">Lateral</option>
                            <option value="Mediocampista Central">Mediocampista Central</option>
                            <option value="Mediocampista Ofensiva">Mediocampista Ofensiva</option>
                            <option value="Volante">Volante</option>
                            <option value="Delantera">Delantera</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Peso (kg)</label>
                        <input type="number" id="p-weight" placeholder="0">
                    </div>
                    <div class="input-group">
                        <label>Altura (cm)</label>
                        <input type="number" id="p-height" placeholder="0">
                    </div>
                    <div class="input-group">
                        <label>Apto F√≠sico</label>
                        <select id="p-apto">
                            <option value="Apto">Apto</option>
                            <option value="Lesionada">Lesionada</option>
                            <option value="En Recuperaci√≥n">En Recuperaci√≥n</option>
                            <option value="No Apto">No Apto</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Obra Social / Prepaga</label>
                        <input type="text" id="p-insurance" placeholder="Nombre de la obra social">
                    </div>
                    <div class="input-group">
                        <label>Tel√©fono Jugadora</label>
                        <input type="tel" id="p-phone" placeholder="Ej: 1122334455">
                    </div>
                    <div class="input-group">
                        <label>Contacto Emergencia</label>
                        <input type="tel" id="p-emergency" placeholder="Nombre y Tel√©fono">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary"
                        onclick="playersManager.showAddModal(false)">Cancelar</button>
                    <button type="submit" id="player-submit-btn" class="btn btn-primary">Guardar
                        Jugadora</button>
                </div>
            </form>
        </div>
    </div>
    <script src="js/firebase-config.js"></script>

    <!-- GIF Generation Library -->
    <script src="https://cdn.jsdelivr.net/npm/gifshot@0.4.5/dist/gifshot.min.js"></script>

    <script src="js/auth.js?v=1.1"></script>
    <script src="js/players.js?v=1.1"></script>
    <script src="js/matches.js?v=1.1"></script>
    <script src="js/attendance.js?v=1.1"></script>
    <script src="js/planning.js?v=1.1"></script>
    <script src="js/library.js?v=1.1"></script>
    <script src="js/stats.js?v=1.1"></script>
    <script src="js/app.js?v=1.1"></script>
    <script src="js/tactic-board.js?v=1.1"></script>
    <script src="js/gif-maker.js?v=1.1"></script>
    <!-- Modal: Add Exercise -->
    <div id="modal-exercise" class="modal-overlay">
        <div class="modal-card">
            <h3>Agregar Ejercicio</h3>
            <form id="add-exercise-form" onsubmit="event.preventDefault(); libraryManager.addExercise()">
                <div class="input-group">
                    <label>T√≠tulo</label>
                    <input type="text" id="ex-title" placeholder="Ej: Rueda de pases" required>
                </div>
                <div class="input-group">
                    <label>Categor√≠a</label>
                    <select id="ex-cat">
                        <option value="T√°ctico">T√°ctico</option>
                        <option value="T√©cnico">T√©cnico</option>
                        <option value="F√≠sico">F√≠sico</option>
                        <option value="Arqueras">Arqueras</option>
                        <option value="ABP">Estrategia (ABP)</option>
                        <option value="Calor">Entrada en Calor</option>
                        <option value="Psicol√≥gico">Psicol√≥gico</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Descripci√≥n / Objetivos</label>
                    <textarea id="ex-desc" placeholder="Detalles del ejercicio..."></textarea>
                </div>
                <div class="input-group">
                    <label>Archivo GIF</label>
                    <div style="display:flex; gap:10px;">
                        <input type="url" id="ex-gif" placeholder="URL del GIF o selecciona de galer√≠a" style="flex:1;">
                        <button type="button" class="btn btn-secondary" onclick="libraryManager.showGifGallery(true)"
                            title="Galer√≠a de GIFs creados">
                            <i class="fas fa-images"></i>
                        </button>
                    </div>
                    <small class="text-muted">Puedes pegar una URL o elegir uno creado en el Creador de GIFs.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="libraryManager.showAddModal(false)">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal: Exercise Detail (Solo View) -->
    <div id="modal-exercise-detail" class="modal-overlay">
        <div class="modal-card" style="max-width: 700px; width: 95%;">
            <div id="exercise-detail-content">
                <!-- Se llena con JS -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                    onclick="libraryManager.showDetailModal(false)">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Player Detail (Side Panel) -->
    <div id="modal-player-detail" class="modal-overlay">
        <div class="modal-card">
            <div id="player-detail-content">
                <!-- Se llena din√°micamente con JS -->
            </div>
        </div>
    </div>

    <!-- Modal: Agregar Partido -->
    <div id="modal-match" class="modal-overlay">
        <div class="modal-card">
            <h2 id="match-modal-title">Programar Partido</h2>
            <form id="match-form">
                <input type="hidden" id="match-edit-id">
                <div class="form-grid">
                    <div class="input-group">
                        <label>Torneo / Liga</label>
                        <input type="text" id="m-tournament" placeholder="Ej: Apertura 2026">
                    </div>
                    <div class="input-group">
                        <label>Categor√≠a</label>
                        <select id="m-category" required>
                            <option value="1ra">1ra Divisi√≥n</option>
                            <option value="Res">Reserva</option>
                            <option value="Sub17">Sub 17</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Rival</label>
                        <input type="text" id="m-rival" placeholder="Nombre de equipo" required>
                    </div>
                    <div class="input-group">
                        <label>Condici√≥n</label>
                        <select id="m-condition">
                            <option value="Local">Local</option>
                            <option value="Visitante">Visitante</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Fecha del Partido</label>
                        <input type="date" id="m-date-only" required>
                    </div>
                    <div class="input-group">
                        <label>Hora (Opcional)</label>
                        <input type="time" id="m-time-only">
                    </div>
                    <div class="input-group" style="grid-column: 1/-1;">
                        <label>Ubicaci√≥n / Cancha</label>
                        <input type="text" id="m-location" placeholder="Ej: Club Los Palometas">
                    </div>
                    <div class="input-group">
                        <label>Goles Palometas</label>
                        <input type="number" id="m-score-local" placeholder="-" min="0">
                    </div>
                    <div class="input-group">
                        <label>Goles Rival</label>
                        <input type="number" id="m-score-rival" placeholder="-" min="0">
                    </div>
                    <div class="input-group" style="grid-column: 1/-1;">
                        <label>Observaciones</label>
                        <textarea id="m-observations" placeholder="Detalles, citaci√≥n, etc."></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary"
                        onclick="matchesManager.showAddModal(false)">Cancelar</button>
                    <button type="submit" id="match-submit-btn" class="btn btn-primary">Guardar Partido</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal: Galer√≠a de GIFs -->
    <div id="modal-gif-gallery" class="modal-overlay">
        <div class="modal-card" style="max-width: 800px; width: 95%;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                <h3>Galer√≠a de GIFs T√°cticos</h3>
                <button class="btn-icon" onclick="libraryManager.showGifGallery(false)"><i
                        class="fas fa-times"></i></button>
            </div>
            <div id="gif-gallery-grid"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; max-height: 500px; overflow-y: auto;">
                <!-- JS Populated -->
            </div>
        </div>
    </div>
</body>

</html>